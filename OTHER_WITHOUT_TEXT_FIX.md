# Исправление: Предотвращение вызова AI при выборе "Other" без текста

## Проблема
Когда пользователь выбирал опцию "Other", немедленно отправлялся запрос к AI, даже если текстовое поле еще было пустым. Это было неправильное поведение - запрос должен отправляться только после того, как пользователь введет текст и покинет поле.

## Исправления

### 1. QuestionSection.js - логика определения валидного ответа

#### handleAnswerChange (строки 299-354)
- Добавлена проверка `hasOnlyOtherWithoutText`
- Для multi-choice: если выбран ТОЛЬКО "other" без текста - ответ невалидный
- Для single-choice: если выбран "other" без текста - ответ невалидный
- Множественный выбор с другими опциями остается валидным

#### handleAnswerBlur (строки 395-451)
- Добавлена та же логика проверки `hasOnlyOtherWithoutText`
- Предотвращает отправку запроса к AI если выбран только "other" без текста

#### getQuestionState (строки 67-117)
- Обновлена логика состояния вопроса
- Вопросы с только "other" без текста показываются как "unanswered"

### 2. AnswerInput.js - предотвращение немедленной отправки

#### Multi-choice (строки 180-200)
```javascript
// Don't submit immediately if selecting/deselecting "other" without text
let shouldSubmitNow = true;
if (q.with_other && q.other_text_id && optionCode === 'other') {
    const otherText = answers[q.other_text_id] || '';
    // If selecting "other" and text field is empty, don't submit
    if (!selectedOptions.includes('other') && otherText.trim() === '') {
        shouldSubmitNow = false;
    }
    // If only "other" will be selected and no text, don't submit
    if (newSelected.length === 1 && newSelected[0] === 'other' && otherText.trim() === '') {
        shouldSubmitNow = false;
    }
}
```

#### Single-choice dropdown и radio (строки 135-189)
Аналогичная логика для предотвращения немедленной отправки при выборе "other" без текста.

## Логика работы после исправления

### Сценарий 1: Выбор только "Other" без текста
1. Пользователь выбирает "Other"
2. Появляется пустое текстовое поле
3. **Запрос к AI НЕ отправляется**
4. Вопрос остается в состоянии "unanswered"

### Сценарий 2: Выбор "Other" с текстом
1. Пользователь выбирает "Other"
2. Вводит текст в поле
3. При потере фокуса (onBlur) отправляется запрос к AI
4. Вопрос переходит в состояние "waiting_for_evaluation"

### Сценарий 3: Множественный выбор с пустым "Other"
1. Пользователь выбирает несколько опций, включая "Other"
2. Текстовое поле "Other" остается пустым
3. **Запрос к AI отправляется** (есть другие валидные ответы)
4. Вопрос считается отвеченным

## Тестирование

Создан тест `test_other_without_text_no_ai.py` который проверяет:
- "Other" без текста не вызывает AI (single и multi-choice)
- "Other" с текстом корректно вызывает AI
- Множественный выбор с пустым "Other" работает
- Состояния вопросов корректно отражают полноту ответов

## Результат

✅ **Исправлено нежелательное поведение**
- "Other" без текста больше не вызывает AI
- Запросы отправляются только при полных ответах
- Сохранена функциональность множественного выбора

✅ **Улучшен пользовательский опыт**
- Нет лишних запросов к API
- Корректное отображение состояния вопросов
- Логичное поведение при работе с "Other" полями