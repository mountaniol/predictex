# Исправление: Предотвращение вызова AI при деактивации вопроса

## Проблема
Когда пользователь снимал все отметки с вопроса (например, выбирал "Other" в вопросе "Why are you selling now?", а затем снимал отметку), система отправляла запрос к AI для оценки. Это было неправильное поведение - вопрос должен просто переходить в состояние "not answered" без вызова AI.

## Исправления

### 1. QuestionSection.js - handleAnswerBlur
**Файл:** `src/QuestionSection.js` (строки 344-393)

**Изменения:**
- Добавлена комплексная проверка наличия валидного ответа перед вызовом AI
- Проверяется тип ответа (массив, строка, другое) и его содержимое
- Для массивов проверяется, что они не пустые
- Для строк проверяется, что они не пустые и не состоят только из пробелов
- Добавлена поддержка поиска вопроса по `other_text_id`
- Добавлено логирование для отладки

### 2. AnswerInput.js - onBlur для "Other" текстового поля
**Файл:** `src/AnswerInput.js` (строка 203)

**Изменения:**
- Исправлен вызов `onBlur` для текстового поля "Other"
- Теперь передается `otherTextId` вместо `q.id`
- Это гарантирует правильную обработку blur события для дополнительных текстовых полей

## Логика работы после исправления

1. **При снятии всех отметок:**
   - Вопрос переходит в состояние "not answered"
   - Очищаются scores и explanations для вопроса
   - AI НЕ вызывается

2. **При вводе/изменении ответа:**
   - Если ответ валидный (не пустой), может быть вызван AI
   - Если ответ пустой/невалидный, AI не вызывается

3. **Специальная обработка "Other":**
   - Текстовое поле "Other" отображается только когда выбран пункт "Other"
   - При снятии отметки "Other", текстовое поле автоматически очищается
   - Blur на текстовом поле "Other" правильно обрабатывается

## Тестирование

Созданы тесты для проверки исправлений:
- `test_no_ai_call_on_deselect.py` - проверяет, что AI не вызывается при деактивации вопроса
- Все существующие тесты также проходят успешно

## Результат

После исправления:
- ✅ Пустые массивы не вызывают AI оценку
- ✅ Пустые строки не вызывают AI оценку
- ✅ Null/undefined значения не вызывают AI оценку
- ✅ Вопросы корректно переходят в состояние "unanswered" без вызова AI
- ✅ Только валидные, непустые ответы вызывают AI оценку